{{define "navbar"}}

<nav class="p-2 mt-0 w-full">
  <div class="container mx-auto flex flex-wrap items-center">
    <div
      class="flex w-full md:w-1/2 justify-center md:justify-start text-white font-extrabold"
    >
      <a
        class="text-white no-underline hover:text-white hover:no-underline flex items-center"
        href="/"
      >
        <img
          src="/web/static/img/mic.png"
          alt="mic"
          class="w-8 h-10 mr-2 filter invert"
        />
        <span class="text-2xl pl-2">Groupie Tracker</span>
      </a>
    </div>
    <div
      class="flex w-full pt-2 content-center justify-between md:w-1/2 md:justify-end"
    >
      <form
        class="flex w-full md:w-auto relative"
        action="/search"
        method="GET"
      >
        <div class="relative inline-block text-left">
          <div>
            <i class="fas fa-search search-icon" style="color: #2d3748"></i>
            <input
              class="rounded-full p-2 pl-9 mr-5 text-gray-800 bg-white focus:outline-none"
              id="search-input"
              name="query"
              type="text"
              placeholder="Search"
            />
          </div>

          <div
            class="absolute left-0 z-10 mt-2 w-64 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none max-h-96 overflow-y-auto"
          >
            <div class="py-1 hidden" id="suggestions-dropdown"></div>
          </div>
        </div>

        <a href="#" class="text-white p-2 search-button font-bold"> Search </a>
        <a
          href="#"
          class="ml-4 px-4 rounded-2xl text-white font-bold p-2 filter-button"
        >
          Filter
        </a>
      </form>
    </div>
  </div>
</nav>

<script>
  // Get the search input element and the suggestions dropdown
  var searchInput = document.getElementById('search-input');
  var dropdown = document.getElementById('suggestions-dropdown');

  // Add an event listener for input changes
  searchInput.addEventListener('input', function () {
    // Get the current input value
    var query = searchInput.value;

    if (query.length < 1) {
      // If the query is less than 3 characters, clear the dropdown and return
      dropdown.innerHTML = '';
      dropdown.style.display = 'none';
      return;
    }

    // Call the /suggest endpoint with the current query
    fetch('/suggest?query=' + encodeURIComponent(query))
      .then((response) => response.json())
      .then((suggestions) => {
        // Clear the current suggestions
        dropdown.innerHTML = '';

        // If there are suggestions, show the dropdown
        if (suggestions.length > 0) {
          dropdown.style.display = 'block';
        }

        // Add each suggestion to the dropdown
        suggestions.forEach((suggestion) => {
          var item = document.createElement('a');
          item.textContent =
            suggestion.Name +
            ' - ' +
            suggestion.Type +
            ' - ' +
            suggestion.Artist.name;
          item.setAttribute(
            'class',
            'text-gray-700 block px-4 py-2 text-sm cursor-pointer hover:bg-gray-100'
          );
          item.href = '/artist/' + encodeURIComponent(suggestion.Artist.id);
          dropdown.appendChild(item);
        });
      });
  });
</script>

{{end}}
